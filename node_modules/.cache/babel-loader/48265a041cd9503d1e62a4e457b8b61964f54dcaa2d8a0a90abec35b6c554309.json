{"ast":null,"code":"// External Charity API utility for React\n// Uses browser crypto.subtle for SHA256 and HMAC\n\nconst API_URL = 'https://stg.foodservices.openapipaas.com/common/social-ewallet/charities?page=0';\nconst API_KEY = 'r4TEOYgoqurHaCR3sLFC';\nconst PROJECT_ID = '205d6cbd-db6c-4dc0-9522-cf011e0dd34c';\nconst PLATFORM_SYSCODE = '101';\n\n// Helper: Get current UTC ISO8601 string\nfunction getUtcIsoString() {\n  return new Date().toISOString();\n}\n\n// Helper: SHA256 hash (returns hex string)\nasync function sha256Hex(str) {\n  const encoder = new TextEncoder();\n  const data = encoder.encode(str);\n  const hashBuffer = await window.crypto.subtle.digest('SHA-256', data);\n  return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');\n}\n\n// Helper: HMAC-SHA256 signature (returns hex string)\nasync function hmacSha256Hex(key, str) {\n  const encoder = new TextEncoder();\n  const keyData = encoder.encode(key);\n  const cryptoKey = await window.crypto.subtle.importKey('raw', keyData, {\n    name: 'HMAC',\n    hash: 'SHA-256'\n  }, false, ['sign']);\n  const sigBuffer = await window.crypto.subtle.sign('HMAC', cryptoKey, encoder.encode(str));\n  return Array.from(new Uint8Array(sigBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');\n}\n\n// Main fetch function\nexport async function getExternalCharities(useStaticHeaders = false) {\n  const method = 'GET';\n  const url = new URL(API_URL);\n  const host = url.host;\n  let datetime, contentSha256, authorization;\n  if (useStaticHeaders) {\n    datetime = '2024-06-07T12:34:56.789Z';\n    contentSha256 = '3q2+7w==';\n    authorization = 'HMAC-SHA256 Credential=r4TEOYgoqurHaCR3sLFC&';\n  } else {\n    datetime = getUtcIsoString();\n    const body = '';\n    contentSha256 = await sha256Hex(body);\n    // Canonical headers and signed headers\n    const canonicalHeaders = [`datetime:${datetime}`, `host:${host}`, `project-id:${PROJECT_ID}`, `platform-syscode:${PLATFORM_SYSCODE}`, `content-sha256:${contentSha256}`];\n    const signedHeaders = 'datetime|host|project-id|platform-syscode|content-sha256';\n    // Canonical request string for signature\n    const canonicalRequest = [method, url.pathname + url.search, canonicalHeaders.join('\\n')].join('\\n');\n    // Signature\n    const signature = await hmacSha256Hex(API_KEY, canonicalRequest);\n    // Authorization header\n    authorization = `HMAC-SHA256 Credential=${API_KEY}&SignedHeaders=${signedHeaders}&Signature=${signature}`;\n  }\n  // Headers\n  const headers = {\n    'api-key': API_KEY,\n    'project-id': PROJECT_ID,\n    'platform-syscode': PLATFORM_SYSCODE,\n    'Content-Type': 'application/json',\n    'datetime': datetime,\n    'content-sha256': contentSha256,\n    'Authorization': authorization\n  };\n  // Fetch\n  const res = await fetch(API_URL, {\n    method,\n    headers\n  });\n  if (!res.ok) throw new Error('Failed to fetch charities: ' + res.status);\n  const json = await res.json();\n  // Return the data array\n  return json.result && Array.isArray(json.result.data) ? json.result.data : [];\n}","map":{"version":3,"names":["API_URL","API_KEY","PROJECT_ID","PLATFORM_SYSCODE","getUtcIsoString","Date","toISOString","sha256Hex","str","encoder","TextEncoder","data","encode","hashBuffer","window","crypto","subtle","digest","Array","from","Uint8Array","map","b","toString","padStart","join","hmacSha256Hex","key","keyData","cryptoKey","importKey","name","hash","sigBuffer","sign","getExternalCharities","useStaticHeaders","method","url","URL","host","datetime","contentSha256","authorization","body","canonicalHeaders","signedHeaders","canonicalRequest","pathname","search","signature","headers","res","fetch","ok","Error","status","json","result","isArray"],"sources":["C:/Users/corva/Downloads/React Code/src/services/externalCharityApi.js"],"sourcesContent":["// External Charity API utility for React\r\n// Uses browser crypto.subtle for SHA256 and HMAC\r\n\r\nconst API_URL = 'https://stg.foodservices.openapipaas.com/common/social-ewallet/charities?page=0';\r\nconst API_KEY = 'r4TEOYgoqurHaCR3sLFC';\r\nconst PROJECT_ID = '205d6cbd-db6c-4dc0-9522-cf011e0dd34c';\r\nconst PLATFORM_SYSCODE = '101';\r\n\r\n// Helper: Get current UTC ISO8601 string\r\nfunction getUtcIsoString() {\r\n  return new Date().toISOString();\r\n}\r\n\r\n// Helper: SHA256 hash (returns hex string)\r\nasync function sha256Hex(str) {\r\n  const encoder = new TextEncoder();\r\n  const data = encoder.encode(str);\r\n  const hashBuffer = await window.crypto.subtle.digest('SHA-256', data);\r\n  return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');\r\n}\r\n\r\n// Helper: HMAC-SHA256 signature (returns hex string)\r\nasync function hmacSha256Hex(key, str) {\r\n  const encoder = new TextEncoder();\r\n  const keyData = encoder.encode(key);\r\n  const cryptoKey = await window.crypto.subtle.importKey(\r\n    'raw', keyData, { name: 'HMAC', hash: 'SHA-256' }, false, ['sign']\r\n  );\r\n  const sigBuffer = await window.crypto.subtle.sign('HMAC', cryptoKey, encoder.encode(str));\r\n  return Array.from(new Uint8Array(sigBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');\r\n}\r\n\r\n// Main fetch function\r\nexport async function getExternalCharities(useStaticHeaders = false) {\r\n  const method = 'GET';\r\n  const url = new URL(API_URL);\r\n  const host = url.host;\r\n  let datetime, contentSha256, authorization;\r\n  if (useStaticHeaders) {\r\n    datetime = '2024-06-07T12:34:56.789Z';\r\n    contentSha256 = '3q2+7w==';\r\n    authorization = 'HMAC-SHA256 Credential=r4TEOYgoqurHaCR3sLFC&';\r\n  } else {\r\n    datetime = getUtcIsoString();\r\n    const body = '';\r\n    contentSha256 = await sha256Hex(body);\r\n    // Canonical headers and signed headers\r\n    const canonicalHeaders = [\r\n      `datetime:${datetime}`,\r\n      `host:${host}`,\r\n      `project-id:${PROJECT_ID}`,\r\n      `platform-syscode:${PLATFORM_SYSCODE}`,\r\n      `content-sha256:${contentSha256}`\r\n    ];\r\n    const signedHeaders = 'datetime|host|project-id|platform-syscode|content-sha256';\r\n    // Canonical request string for signature\r\n    const canonicalRequest = [\r\n      method,\r\n      url.pathname + url.search,\r\n      canonicalHeaders.join('\\n')\r\n    ].join('\\n');\r\n    // Signature\r\n    const signature = await hmacSha256Hex(API_KEY, canonicalRequest);\r\n    // Authorization header\r\n    authorization = `HMAC-SHA256 Credential=${API_KEY}&SignedHeaders=${signedHeaders}&Signature=${signature}`;\r\n  }\r\n  // Headers\r\n  const headers = {\r\n    'api-key': API_KEY,\r\n    'project-id': PROJECT_ID,\r\n    'platform-syscode': PLATFORM_SYSCODE,\r\n    'Content-Type': 'application/json',\r\n    'datetime': datetime,\r\n    'content-sha256': contentSha256,\r\n    'Authorization': authorization\r\n  };\r\n  // Fetch\r\n  const res = await fetch(API_URL, { method, headers });\r\n  if (!res.ok) throw new Error('Failed to fetch charities: ' + res.status);\r\n  const json = await res.json();\r\n  // Return the data array\r\n  return (json.result && Array.isArray(json.result.data)) ? json.result.data : [];\r\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}